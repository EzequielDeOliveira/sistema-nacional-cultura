{% extends "base.html" %}
{% load widget_tweaks %}
{% block content %}
<div class="container">
<form method="post" enctype="multipart/form-data">
  {% csrf_token %}
  <h3>
    <strong>Estruturação dos Componentes</strong>
  </h3>
  <h5>
    <strong>2.2 Instalação do Conselho de Política Cultural</strong>
  </h5>
  <div class="form-group">
    <label for={{ form.data_final_instalacao_conselho.id_for_label }} class="col-sm-12">
      Data final para instalação do Conselho de Política Cultural
    </label>
    {% if request.user.usuario.plano_trabalho.conselho_cultural %}
      {% render_field form.data_final_instalacao_conselho readonly="true" %}
    {% else %}
      {% render_field form.data_final_instalacao_conselho class="date"%}
    {% endif %}
    {{ form.data_final_instalacao_conselho.errors }}
  </div>
  {% if request.user.usuario.plano_trabalho.conselho_cultural %}
  <div class="form-group">
    <label for="{{ form.ata_regimento_aprovado.id_for_label }}">
      Ata da reunião de instalação e Regimento Aprovado
    </label>
    {% if form.ata_regimento_aprovado.value %}
    <p><a href="{{ form.ata_regimento_aprovado.value.url }}">Baixar arquivo atual</a></p>
    {% if request.user.usuario.plano_trabalho.conselho_cultural.situacao_ata != 2 %}
    <p>Modificar: {% render_field form.ata_regimento_aprovado %}</p>
    {% endif %}
    {% else %}
    <p>{% render_field form.ata_regimento_aprovado %}</p>
    {% endif %}
    {{ form.ata_regimento_aprovado.errors }}
  </div>
  <div class="form-group">
    <label>Conselheiros (clique no + para adicionar mais conselheiros)</label><br/>
    <div class="actions">
      <input type="text" name="conselheiro" placeholder="Nome Completo" class="form-control"/>
      <input type="text" name="cpf" placeholder="CPF" class="form-control cpf"/>
      <input type="email" name="email" placeholder="Email" class="form-control"/><br/>
    </div>
    <button type="button" class="btn btn-success add">
      <i class="fa fa-plus"></i>
    </button>
    <button type="button" class="btn btn-warning del">
      <i class="fa fa-minus"></i>
    </button>
  </div>
  {% endif %}

  <div class="alert alert-info" role="alert">
    <strong>Para execução, sugerimos as seguintes atividades!</strong><br>
    - Mobilizar a sociedade, em especial as redes culturais;<br>
    - Realizar o processo de eleição;<br>
    - Definir estrutura de apoio/suporte ao conselho;<br>
    - Convocar os Conselheiros eleitos e realizar reunião de instalação e posse;<br>
    - Aprovar o regimento Interno do Conselho.
  </div>

  <input type="submit" class="btn btn-success" value="Salvar" />
</form>
</div>
<script type="text/javascript">
  input = $('.actions:first').clone();
  $('.add').click(function() {
        input.clone().attr('id', 'conselheiro_' + $('.actions').length)
        .insertAfter($('.actions:last'));
        {% verbatim %}
        $(".cpf").formatter({
          'pattern': '{{999}}.{{999}}.{{999}}-{{99}}',
          'persistent': false,
        });
        {% endverbatim %}
  });
  $('.del').click(function() {
    if($('.actions').length > 1)
      $('.actions:last').remove();
  });

  $.ajax({
    type: "GET",
    url: "/planotrabalho/conselheiros",
    cache: false,
    data: {
      'id': {{object.id}},
    },
    success: function(data){
      data['conselheiros'].forEach(function(val, index, array){
        input
        .clone()
        .attr('id', 'conselheiro_' + $('.actions').length)
        .insertAfter($('.actions:last'))
        .children('[name=conselheiro]')
        .attr('value', val[0])
        .parent()
        .children('[name=cpf]')
        .attr('value', val[1])
        .parent()
        .children('[name=email]')
        .attr('value', val[2]);
      });
    },
  });
</script>
{% endblock content %}
